---
title: "Data Transformation Exercise"
author: "Ben Rogers"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(nycflights13)
```

We will work on the `flights` dataset for the exercise.

  -   Select all flights on January 1st
  -   Find flights that weren’t delayed (on arrival or departure) by more than two hours
  -   How many flights have a missing `dep_time`? What might these rows represent?
```{r}
flights %>%
  filter(month == 1, day == 1)
```


```{r}
flights %>%
  filter(arr_delay <= 120 | arr_delay <= 120)
```


```{r}
flights %>%
  filter(is.na(dep_time))
```

---------


  -   How does `arrange()` work with missing values? How could you use `arrange()` to sort all missing values to the start?
  -   Sort flights to find the most delayed flights.
  -   Sort flights to find the fastest flights.(in terms of flight time and speed)

```{r}
flights %>% 
  arrange(desc(is.na(dep_time)))

flights %>% 
  arrange(desc(dep_delay))

fastest <- flights %>% 
  arrange(desc(distance/air_time))
```


--------

  -   Currently dep_time and `sched_dep_time` are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.
  -   Compare `air_time` with `arr_time - dep_time`. What do you expect to see? What do you see? What do you need to do to fix it?
  -   Compare `dep_time`, `sched_dep_time`, and `dep_delay`. How would you expect those three numbers to be related?

```{r}
f <- flights %>% 
  mutate(dep_convert_time = (dep_time %/% 100)*60 + dep_time%%60)

  flights %>% 
    mutate(arr_dep = (arr_time - dep_time))
```


---------


  -   Use the summarize() function to get the mean of dep_delay for each day.
```{r}
flights %>% 
  group_by(year, month, day) %>% 
  summarise(mean = mean(dep_delay, na.rm = TRUE))

``` 
  -   Obtain the average delays of the planes (identified by their tail number). Which one has the highest delay? Plot a histogram for the average delays.
  
```{r}
flights %>% 
  group_by(tailnum) %>% 
  summarise(avg_delay = mean((arr_delay + dep_delay) / 2, na.rm = TRUE)) %>% 
  arrange(desc(avg_delay)) %>% 
  ggplot(flights, mapping = aes(x=tailnum)) + 
  geom_histogram(stat="count")
```
  -   When do the first and last flight leave each day?
```{r}
flights %>% 
  group_by(year, month, day, flight) %>% 
  arrange(dep_time)
  
```


  -   Which destinations have the most carriers?
```{r}
flights %>% 
  group_by(dest) %>% 
  summarise(n = n()) %>% 
  arrange(desc(n))
```
  -   What proportion of flights are delayed by more than an hour each day?
  -   Which carrier has the worst delays?
```{r}
flights %>% 
  group_by(carrier) %>% 
  summarise(mean = mean (dep_delay, na.rm = TRUE))
```
  -   What time of a day should you fly if you want to avoid delays as much as possible?
  -   Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?
  -   Find all destinations that are flown by at least two carriers. Use that information to rank the carriers.
